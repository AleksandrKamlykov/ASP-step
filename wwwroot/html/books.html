<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Books</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div style="display:flex; gap: 8px">
            <select>
                <option value="Title">Title</option>

                <option value="ISBN">ISBN</option>
            </select>
            <select>
                <option value="ACS">Ascending</option>
                <option value="DESC">Descending</option>
            </select>
            <input placeholder="value" />
            <button class="btn btn-primary" id="btn-search">Search</button>
        </div>
    </div>
    <table  class="table">
        <thead>
            <tr><th>ISBN</th><th>Title</th><th>Author</th></tr>
        </thead>
        <tbody>
        </tbody>
        </table>
    <script>
        const tbody = document.querySelector('tbody');

        const serachBtn = document.getElementById('btn-search');
        serachBtn.addEventListener('click', searchBooks);

        window.onload = main;

        async function fetchBooks() {
            tbody.innerHTML = '';
            const response = await fetch('/api/books');
            const books = await response.json();

            setDataToTable(books);    
        }

        function addBookRow(book) {
            const tr = document.createElement('tr');
            tr.setAttribute('data-book-id', book.id);
            tr.innerHTML = `
                    <td>${book.isbn}</td>
                    <td>${book.title}</td>
                    <td>${book.author}</td>

                `;
            tbody.appendChild(tr);
        }

        function setDataToTable(data) {
            tbody.innerHTML = '';
            data.forEach(book => {
                addBookRow(book);
            });
        }

        async function searchBooks() {
            const select = document.querySelector('select');
            const select2 = document.querySelector('select:nth-child(2)');
            const input = document.querySelector('input');

            const searchParams = new URLSearchParams();
            if (select.value) {
                searchParams.append('key', select.value)
            }
            if (select2.value) {
                searchParams.append('order', select2.value)
            }
            if (input.value) {
               searchParams.append('value', input.value)
            }
            const response = await fetch(`api/books?${searchParams.toString()}`);
            const books = await response.json();

            setDataToTable(books);
        }

        async function main() {
            await fetchBooks();
        }
        </script>
</body>
</html>