<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Users</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <table class='table'>
        <thead>
            <tr><th>Name</th><th>Email</th><th>Phone</th><th></th><th></th></tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const tbody = document.querySelector('tbody');

        window.onload = main;

        async function fetchUsers() {
            const response = await fetch('/api/users');
            const users = await response.json();

            users.forEach(user => {
                addUserRow(user);
            });
        }

        function addUserRow(user) {
            const tr = document.createElement('tr');
            tr.setAttribute('data-user-id', user.id);
            tr.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td><a href="/form?id=${user.id}">Edit</a></td>
                    <td><button onclick="deleteUser('${user.id}')">Delete</button></td>
                `;
            tbody.appendChild(tr);
        }

        async function deleteUser(id) {
            const response = await fetch(`/api/users/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                const tr = document.querySelector(`tr[data-user-id="${id}"]`);
                tr.remove();
            }
        }

        async function main() {
            await fetchUsers();
        }
    </script>
</body>
</html>
